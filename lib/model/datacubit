import 'package:bloc/bloc.dart';
import 'product.dart';
import 'package:dio/dio.dart';
import 'dart:convert';

class ProductCubit extends Cubit<DataState> {
 
  ProductCubit() : super(DataInitial());
  StylishCategory femaleCategory = StylishCategory("女裝", <Product>[]);
  StylishCategory maleCategory = StylishCategory("男裝", <Product>[]);
  StylishCategory acceCategory = StylishCategory("配件", <Product>[]);

  void fetchFemaleData() async {
    emit(DataLoadingState());
  Dio dio = Dio();
  try {
    Response response =
        await dio.get('https://api.appworks-school.tw/api/1.0/products/women');
    if (response.statusCode == 200) {
      emit(DataLoaded.updateFemaleList(jsonDecode(response.data)));
      print(response.data);
    } else {
      emit(DataErrorState(errorMessage: 'fail'));
    }
  } catch (e) {
   emit(DataErrorState(errorMessage: 'fail: $e'));
  }
}
}

//定義好state
class DataState {}
class DataInitial extends DataState {}
class DataLoading extends DataState {}
class DataLoaded extends DataState {
 void updateFemaleList(List<Product> list) {
    femaleCategory.productList.clear();
    femaleCategory.productList.addAll(list);
  }

  void updateMaleList(List<Product> list) {
    maleCategory.productList.clear();
    maleCategory.productList.addAll(list);
  }

  void updateAcceList(List<Product> list) {
    acceCategory.productList.clear();
    acceCategory.productList.addAll(list);
  }
}
class DataError extends DataState {
  final String errorMessage;
  DataError(this.errorMessage);
}